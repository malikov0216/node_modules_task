{"version":3,"sources":["../../../src/features/view-drd/ViewDrd.js"],"names":["ViewDrdComponent","ViewDrd","components","eventBus","injector","sheet","_injector","_sheet","onGetComponent","canViewDrd","on","parent","get","root","getRoot","definitions","getDefinitions","view","getView","open","$inject","businessObject","decision","$parent"],"mappings":";;;;AAAA,OAAOA,gBAAP,MAA6B,+BAA7B;;IAEqBC,O;AACnB,mBAAYC,UAAZ,EAAwBC,QAAxB,EAAkCC,QAAlC,EAA4CC,KAA5C,EAAmD;AAAA;;AAAA;;AACjD,SAAKC,SAAL,GAAiBF,QAAjB;AACA,SAAKG,MAAL,GAAcF,KAAd;;AAEAH,eAAWM,cAAX,CAA0B,cAA1B,EAA0C,YAAM;AAC9C,UAAI,MAAKC,UAAL,EAAJ,EAAuB;AACrB,eAAOT,gBAAP;AACD;AACF,KAJD;;AAMAG,aAASO,EAAT,CAAY,SAAZ,EAAuB,YAAM;AAC3B,UAAMC,SAASP,SAASQ,GAAT,CAAa,SAAb,EAAwB,KAAxB,CAAf;;AAEA,UAAMC,OAAOR,MAAMS,OAAN,EAAb;;AAEA,UAAMC,cAAcC,eAAeH,IAAf,CAApB;;AAEA,UAAI,CAACE,WAAL,EAAkB;AAChB;AACD;;AAED;AACA,UAAME,OAAON,OAAOO,OAAP,CAAeH,WAAf,CAAb;;AAEAJ,aAAOQ,IAAP,CAAYF,IAAZ;AACD,KAfD;AAgBD;;;;iCAEY;AACX,UAAMN,SAAS,KAAKL,SAAL,CAAeM,GAAf,CAAmB,SAAnB,EAA8B,KAA9B,CAAf;;AAEA,UAAI,CAACD,MAAL,EAAa;AACX,eAAO,KAAP;AACD;;AAED,UAAME,OAAO,KAAKN,MAAL,CAAYO,OAAZ,EAAb;;AAEA,UAAMC,cAAcC,eAAeH,IAAf,CAApB;;AAEA,aAAO,CAAC,CAACF,OAAOO,OAAP,CAAeH,WAAf,CAAT;AACD;;;;;;eAzCkBd,O;;;AA4CrBA,QAAQmB,OAAR,GAAkB,CAAE,YAAF,EAAgB,UAAhB,EAA4B,UAA5B,EAAwC,OAAxC,CAAlB;;AAGA;;AAEA,SAASJ,cAAT,CAAwBH,IAAxB,EAA8B;AAAA,MACpBQ,cADoB,GACDR,IADC,CACpBQ,cADoB;;AAG5B;;AACA,MAAI,CAACA,cAAL,EAAqB;AACnB;AACD;;AAED,MAAMC,WAAWD,eAAeE,OAAhC;;AAEA,MAAMR,cAAcO,SAASC,OAA7B;;AAEA,SAAOR,WAAP;AACD","file":"ViewDrd.js","sourcesContent":["import ViewDrdComponent from './components/ViewDrdComponent';\r\n\r\nexport default class ViewDrd {\r\n  constructor(components, eventBus, injector, sheet) {\r\n    this._injector = injector;\r\n    this._sheet = sheet;\r\n\r\n    components.onGetComponent('table.before', () => {\r\n      if (this.canViewDrd()) {\r\n        return ViewDrdComponent;\r\n      }\r\n    });\r\n\r\n    eventBus.on('showDrd', () => {\r\n      const parent = injector.get('_parent', false);\r\n\r\n      const root = sheet.getRoot();\r\n\r\n      const definitions = getDefinitions(root);\r\n\r\n      if (!definitions) {\r\n        return;\r\n      }\r\n\r\n      // open definitions\r\n      const view = parent.getView(definitions);\r\n\r\n      parent.open(view);\r\n    });\r\n  }\r\n\r\n  canViewDrd() {\r\n    const parent = this._injector.get('_parent', false);\r\n\r\n    if (!parent) {\r\n      return false;\r\n    }\r\n\r\n    const root = this._sheet.getRoot();\r\n\r\n    const definitions = getDefinitions(root);\r\n\r\n    return !!parent.getView(definitions);\r\n  }\r\n}\r\n\r\nViewDrd.$inject = [ 'components', 'eventBus', 'injector', 'sheet' ];\r\n\r\n\r\n// helpers //////////////////////\r\n\r\nfunction getDefinitions(root) {\r\n  const { businessObject } = root;\r\n\r\n  // root might not have business object\r\n  if (!businessObject) {\r\n    return;\r\n  }\r\n\r\n  const decision = businessObject.$parent;\r\n\r\n  const definitions = decision.$parent;\r\n\r\n  return definitions;\r\n}"]}