{"version":3,"sources":["../src/Table.js"],"names":["Injector","core","Table","options","injector","_init","modules","config","createInjector","get","invoke","fire","eventBus","bootstrap","bootstrapModules","components","hasModule","m","indexOf","addModule","push","visit","__depends__","forEach","__init__","c","e","console","error","stack","concat"],"mappings":"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","file":"Table.js","sourcesContent":["import { Injector } from 'didi';\n\nimport core from './core';\n\n\nexport default class Table {\n\n  constructor(options = {}) {\n    let {\n      injector\n    } = options;\n\n    if (!injector) {\n      let { modules, config } = this._init(options);\n\n      injector = createInjector(config, modules);\n    }\n\n    this.get = injector.get;\n\n    this.invoke = injector.invoke;\n\n    this.get('eventBus').fire('table.init');\n    this.get('eventBus').fire('diagram.init');\n  }\n\n  /**\n   * Intialize table and return modules and config used for creation.\n   *\n   * @param  {Object} options\n   *\n   * @return {Object} { modules=[], config }\n   */\n  _init(options) {\n    let {\n      modules,\n      ...config\n    } = options;\n\n    return { modules, config };\n  }\n\n  /**\n   * Destroys the table. This results in removing the attachment from the container.\n   */\n  destroy() {\n    const eventBus = this.get('eventBus');\n\n    eventBus.fire('table.destroy');\n    eventBus.fire('diagram.destroy');\n  }\n\n  /**\n   * Clears the table. Should be used to reset the state of any stateful services.\n   */\n  clear() {\n    const eventBus = this.get('eventBus');\n\n    eventBus.fire('table.clear');\n    eventBus.fire('diagram.clear');\n  }\n\n}\n\n\n// helpers /////////////\n\nfunction bootstrap(bootstrapModules) {\n\n  var modules = [],\n      components = [];\n\n  function hasModule(m) {\n    return modules.indexOf(m) >= 0;\n  }\n\n  function addModule(m) {\n    modules.push(m);\n  }\n\n  function visit(m) {\n    if (hasModule(m)) {\n      return;\n    }\n\n    (m.__depends__ || []).forEach(visit);\n\n    if (hasModule(m)) {\n      return;\n    }\n\n    addModule(m);\n\n    (m.__init__ || []).forEach(function(c) {\n      components.push(c);\n    });\n  }\n\n  bootstrapModules.forEach(visit);\n\n  var injector = new Injector(modules);\n\n  components.forEach(function(c) {\n\n    try {\n      // eagerly resolve component (fn or string)\n      injector[typeof c === 'string' ? 'get' : 'invoke'](c);\n    } catch (e) {\n      console.error('Failed to instantiate component');\n      console.error(e.stack);\n\n      throw e;\n    }\n  });\n\n  return injector;\n}\n\nfunction createInjector(config, modules) {\n  const bootstrapModules = [\n    {\n      config: [ 'value', config ]\n    },\n    core\n  ].concat(modules || []);\n\n  return bootstrap(bootstrapModules);\n}\n"]}