{"version":3,"sources":["../../../src/features/drill-down/DrillDown.js"],"names":["is","domify","classes","domClasses","delegate","domDelegate","PROVIDERS","className","matches","el","businessObject","decisionTable","literalExpression","DrillDown","injector","eventBus","overlays","config","_injector","_eventBus","_overlays","_config","enabled","on","element","i","length","editable","addOverlay","html","overlayId","add","position","top","left","bindEventListener","overlay","id","overlaysRoot","_overlayRoot","bind","triggerDefault","fire","drillDown","parent","get","view","getView","open","$inject"],"mappings":"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","file":"DrillDown.js","sourcesContent":["import { is } from 'dmn-js-shared/lib/util/ModelUtil';\n\nimport {\n  domify,\n  classes as domClasses,\n  delegate as domDelegate\n} from 'min-dom';\n\n\nvar PROVIDERS = [\n  {\n    className: 'dmn-icon-decision-table',\n    matches: function(el) {\n      var businessObject = el.businessObject;\n\n      return is(businessObject, 'dmn:Decision') && businessObject.decisionTable;\n    }\n  },\n  {\n    className: 'dmn-icon-literal-expression',\n    matches: function(el) {\n      var businessObject = el.businessObject;\n\n      return is(businessObject, 'dmn:Decision') && businessObject.literalExpression;\n    }\n  }\n];\n\n\n/**\n * Displays overlays that can be clicked in order to drill\n * down into a DMN 1.1 element.\n */\nexport default class DrillDown {\n\n  constructor(injector, eventBus, overlays, config) {\n    this._injector = injector;\n    this._eventBus = eventBus;\n    this._overlays = overlays;\n\n    this._config = config || { enabled: true };\n\n    eventBus.on([ 'shape.added' ], ({ element }) => {\n\n      for (let i = 0; i < PROVIDERS.length; i++) {\n\n        const { matches, className } = PROVIDERS[i];\n\n        var editable = matches && matches(element);\n\n        if (editable) {\n          this.addOverlay(element, className);\n        }\n      }\n    });\n  }\n\n  /**\n   * Add overlay to an element that enables drill down.\n   *\n   * @param {Object} element Element to add overlay to.\n   * @param {string} className\n   *        CSS class that will be added to overlay in order to display icon.\n   */\n  addOverlay(element, className) {\n    const html = domify(`\n      <div class=\"drill-down-overlay\">\n        <span class=\"${className}\"></span>\n      </div>\n    `);\n\n    const overlayId = this._overlays.add(element, {\n      position: {\n        top: 2,\n        left: 2\n      },\n      html\n    });\n\n    // TODO(nikku): can we remove renamed to drillDown.enabled\n    if (this._config.enabled !== false) {\n      domClasses(html).add('interactive');\n\n      this.bindEventListener(element, html, overlayId);\n    }\n  }\n\n  /**\n   * @param {Object} element\n   * @param {Object} overlay\n   * @param {string} id\n   */\n  bindEventListener(element, overlay, id) {\n    const overlays = this._overlays,\n          eventBus = this._eventBus;\n\n    const overlaysRoot = overlays._overlayRoot;\n\n    domDelegate.bind(overlaysRoot, '[data-overlay-id=\"' + id + '\"]', 'click', () => {\n\n      const triggerDefault = eventBus.fire('drillDown.click', {\n        element\n      });\n\n      if (triggerDefault === false) {\n        return;\n      }\n\n      this.drillDown(element);\n    });\n  }\n\n\n  /**\n   * Drill down into the specific element.\n   *\n   * @param  {djs.model.Base} element\n   *\n   * @return {Boolean} whether drill down was executed\n   */\n  drillDown(element) {\n\n    const parent = this._injector.get('_parent', false);\n\n    // no parent; skip drill down\n    if (!parent) {\n      return false;\n    }\n\n    const view = parent.getView(element.businessObject);\n\n    // no view to drill down to\n    if (!view) {\n      return false;\n    }\n\n    parent.open(view);\n\n    return true;\n  }\n\n}\n\nDrillDown.$inject = [\n  'injector',\n  'eventBus',\n  'overlays',\n  'config.drillDown'\n];"]}