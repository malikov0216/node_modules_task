{"version":3,"sources":["../../../src/features/rules/DrdRules.js"],"names":["is","isAny","inherits","RuleProvider","DrdRules","eventBus","call","$inject","prototype","init","addRule","context","target","shapes","position","canMove","source","canConnect","connection","hover","canCreate","shape","type","elements"],"mappings":"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","file":"DrdRules.js","sourcesContent":["import {\n  is,\n  isAny\n} from 'dmn-js-shared/lib/util/ModelUtil';\n\nimport inherits from 'inherits';\n\nimport RuleProvider from 'diagram-js/lib/features/rules/RuleProvider';\n\n/**\n * DRD specific modeling rule\n */\nexport default function DrdRules(eventBus) {\n  RuleProvider.call(this, eventBus);\n}\n\ninherits(DrdRules, RuleProvider);\n\nDrdRules.$inject = [ 'eventBus' ];\n\nDrdRules.prototype.init = function() {\n\n  this.addRule('elements.move', function(context) {\n\n    var target = context.target,\n        shapes = context.shapes,\n        position = context.position;\n\n    return canMove(shapes, target, position);\n  });\n\n  this.addRule('connection.create', function(context) {\n    var source = context.source,\n        target = context.target;\n\n    return canConnect(source, target);\n  });\n\n  this.addRule('connection.reconnectStart', function(context) {\n\n    var connection = context.connection,\n        source = context.hover || context.source,\n        target = connection.target;\n\n    return canConnect(source, target, connection);\n  });\n\n  this.addRule('connection.reconnectEnd', function(context) {\n\n    var connection = context.connection,\n        source = connection.source,\n        target = context.hover || context.target;\n\n    return canConnect(source, target, connection);\n  });\n\n  this.addRule('connection.updateWaypoints', function(context) {\n    // OK! but visually ignore\n    return null;\n  });\n\n  this.addRule('shape.create', function(context) {\n    return canCreate(context.shape, context.target);\n  });\n\n};\n\nDrdRules.prototype.canConnect = canConnect;\n\nDrdRules.prototype.canCreate = canCreate;\n\nDrdRules.prototype.canMove = canMove;\n\n\nfunction canConnect(source, target) {\n\n  if (is(source, 'dmn:Definitions') || is(target, 'dmn:Definitions')) {\n    return false;\n  }\n\n  if (is(source, 'dmn:Decision') || is(source, 'dmn:InputData')) {\n    if (is(target, 'dmn:Decision') ||\n       (is(source, 'dmn:Decision') && is(target, 'dmn:InputData'))) {\n      return { type: 'dmn:InformationRequirement' };\n    }\n\n    if (is(target, 'dmn:KnowledgeSource')) {\n      return { type: 'dmn:AuthorityRequirement' };\n    }\n  }\n\n  if (is(source, 'dmn:BusinessKnowledgeModel') &&\n      isAny(target, [ 'dmn:Decision', 'dmn:BusinessKnowledgeModel' ])) {\n    return { type: 'dmn:KnowledgeRequirement' };\n  }\n\n  if (is(source, 'dmn:KnowledgeSource') &&\n      isAny(target, [\n        'dmn:Decision',\n        'dmn:BusinessKnowledgeModel',\n        'dmn:KnowledgeSource'\n      ])) {\n    return { type: 'dmn:AuthorityRequirement' };\n  }\n\n  if (is(target, 'dmn:TextAnnotation')) {\n    return { type: 'dmn:Association' };\n  }\n\n  return false;\n}\n\nfunction canCreate(shape, target) {\n  return is(target, 'dmn:Definitions');\n}\n\nfunction canMove(elements, target) {\n\n  // allow default move check to start move operation\n  if (!target) {\n    return true;\n  }\n\n  if (is(target, 'dmn:Definitions')) {\n    return true;\n  }\n\n  return false;\n}\n"]}