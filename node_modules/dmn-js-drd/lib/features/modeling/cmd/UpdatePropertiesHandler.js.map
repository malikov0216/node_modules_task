{"version":3,"sources":["../../../../src/features/modeling/cmd/UpdatePropertiesHandler.js"],"names":["reduce","keys","forEach","NAME","ID","UpdatePropertiesHandler","elementRegistry","moddle","_elementRegistry","_moddle","$inject","prototype","execute","context","element","changed","Error","ids","businessObject","properties","oldProperties","getProperties","isIdChange","unclaim","updateId","claim","label","push","setProperties","revert","propertyNames","result","key","get","value","set"],"mappings":"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","file":"UpdatePropertiesHandler.js","sourcesContent":["import {\n  reduce,\n  keys,\n  forEach\n} from 'min-dash';\n\nvar NAME = 'name',\n    ID = 'id';\n\n\n/**\n * A handler that implements a DMN property update.\n *\n * This should be used to set simple properties on elements with\n * an underlying DMN business object.\n *\n * Use respective diagram-js provided handlers if you would\n * like to perform automated modeling.\n */\nexport default function UpdatePropertiesHandler(elementRegistry, moddle) {\n  this._elementRegistry = elementRegistry;\n  this._moddle = moddle;\n}\n\nUpdatePropertiesHandler.$inject = [ 'elementRegistry', 'moddle' ];\n\n\n/**\n * Updates a DMN element with a list of new properties\n *\n * @param {Object} context\n * @param {djs.model.Base} context.element the element to update\n * @param {Object} context.properties a list of properties to set on the element's\n *                                    businessObject (the DMN model element)\n *\n * @return {Array<djs.model.Base>} the updated element\n */\nUpdatePropertiesHandler.prototype.execute = function(context) {\n\n  var element = context.element,\n      changed = [ element];\n\n  if (!element) {\n    throw new Error('element required');\n  }\n\n  var elementRegistry = this._elementRegistry,\n      ids = this._moddle.ids;\n\n  var businessObject = element.businessObject,\n      properties = context.properties,\n      oldProperties = (\n        context.oldProperties ||\n        getProperties(businessObject, keys(properties))\n      );\n\n  if (isIdChange(properties, businessObject)) {\n    ids.unclaim(businessObject[ID]);\n\n    elementRegistry.updateId(element, properties[ID]);\n\n    ids.claim(properties[ID], businessObject);\n  }\n\n  if (NAME in properties && element.label) {\n    changed.push(element.label);\n  }\n\n  // update properties\n  setProperties(businessObject, properties);\n\n  // store old values\n  context.oldProperties = oldProperties;\n  context.changed = changed;\n\n  // indicate changed on objects affected by the update\n  return changed;\n};\n\n\n/**\n * Reverts the update on a DMN elements properties.\n *\n * @param  {Object} context\n *\n * @return {djs.model.Base} the updated element\n */\nUpdatePropertiesHandler.prototype.revert = function(context) {\n\n  var element = context.element,\n      properties = context.properties,\n      oldProperties = context.oldProperties,\n      businessObject = element.businessObject,\n      elementRegistry = this._elementRegistry,\n      ids = this._moddle.ids;\n\n  // update properties\n  setProperties(businessObject, oldProperties);\n\n  if (isIdChange(properties, businessObject)) {\n    ids.unclaim(properties[ID]);\n\n    elementRegistry.updateId(element, oldProperties[ID]);\n\n    ids.claim(oldProperties[ID], businessObject);\n  }\n\n  return context.changed;\n};\n\n\nfunction isIdChange(properties, businessObject) {\n  return ID in properties && properties[ID] !== businessObject[ID];\n}\n\n\nfunction getProperties(businessObject, propertyNames) {\n  return reduce(propertyNames, function(result, key) {\n    result[key] = businessObject.get(key);\n    return result;\n  }, {});\n}\n\n\nfunction setProperties(businessObject, properties) {\n  forEach(properties, function(value, key) {\n    businessObject.set(key, value);\n  });\n}\n"]}