{"version":3,"sources":["../src/Viewer.js"],"names":["domify","query","domQuery","remove","domRemove","Diagram","inherits","importDRD","innerSVG","Viewer","options","_container","_createContainer","addProjectLogo","_init","prototype","saveSVG","done","canvas","get","contentNode","getDefaultLayer","defsNode","_svg","contents","defs","outerHTML","bbox","getBBox","svg","width","height","x","y","getModules","_modules","destroy","call","on","event","priority","callback","target","off","container","additionalModules","additionalOptions","baseModules","modules","staticModules","drd","diagramOptions","attachTo","_emit","type","fire","open","definitions","err","_definitions","clear","e","parentNode","Error","detach","appendChild","resized","removeChild","CoreModule","TranslateModule","SelectionModule","OverlaysModule","DefinitionPropertiesModule","DrillDownModule","BPMNIO_IMG","openPoweredBy","domEvent","img","linkMarkup","linkElement","bind","preventDefault"],"mappings":"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","file":"Viewer.js","sourcesContent":["/**\n * The code in the <project-logo></project-logo> area\n * must not be changed.\n *\n * @see http://bpmn.io/license for more information.\n */\n\nimport {\n  domify,\n  query as domQuery,\n  remove as domRemove\n} from 'min-dom';\n\nimport Diagram from 'diagram-js';\n\nimport inherits from 'inherits';\n\nimport {\n  importDRD\n} from './import/Importer';\n\nimport {\n  innerSVG\n} from 'tiny-svg';\n\n\n/**\n * A viewer for DMN 1.1 diagrams.\n *\n * Have a look at {@link NavigatedViewer} or {@link Modeler} for bundles that include\n * additional features.\n *\n *\n * ## Extending the Viewer\n *\n * In order to extend the viewer pass extension modules to bootstrap via the\n * `additionalModules` option. An extension module is an object that exposes\n * named services.\n *\n * The following example depicts the integration of a simple\n * logging component that integrates with interaction events:\n *\n *\n * ```javascript\n *\n * // logging component\n * function InteractionLogger(eventBus) {\n *   eventBus.on('element.hover', function(event) {\n *     console.log()\n *   })\n * }\n *\n * InteractionLogger.$inject = [ 'eventBus' ]; // minification save\n *\n * // extension module\n * var extensionModule = {\n *   __init__: [ 'interactionLogger' ],\n *   interactionLogger: [ 'type', InteractionLogger ]\n * };\n *\n * // extend the viewer\n * var drdViewer = new Viewer({ additionalModules: [ extensionModule ] });\n * drdViewer.importXML(...);\n * ```\n *\n * @param {Object} options configuration options to pass to the viewer\n * @param {DOMElement} [options.container]\n *        the container to render the viewer in, defaults to body\n * @param {Array<didi.Module>} [options.modules]\n *        a list of modules to override the default modules\n * @param {Array<didi.Module>} [options.additionalModules]\n *        a list of modules to use with the default modules\n */\nexport default function Viewer(options) {\n\n  this._container = this._createContainer();\n\n  /* <project-logo> */\n\n  addProjectLogo(this._container);\n\n  /* </project-logo> */\n\n  this._init(this._container, options);\n}\n\ninherits(Viewer, Diagram);\n\n/**\n * Export the currently displayed DMN 1.1 diagram as\n * an SVG image.\n *\n * @param {Object} [options]\n * @param {Function} done invoked with (err, svgStr)\n */\nViewer.prototype.saveSVG = function(options, done) {\n\n  if (!done) {\n    done = options;\n    options = {};\n  }\n\n  var canvas = this.get('canvas');\n\n  var contentNode = canvas.getDefaultLayer(),\n      defsNode = domQuery('defs', canvas._svg);\n\n  var contents = innerSVG(contentNode),\n      defs = (defsNode && defsNode.outerHTML) || '';\n\n  var bbox = contentNode.getBBox();\n\n  /* eslint-disable max-len */\n  var svg =\n    '<?xml version=\"1.0\" encoding=\"utf-8\"?>\\n' +\n    '<!-- created with dmn-js / http://bpmn.io -->\\n' +\n    '<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\\n' +\n    '<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" ' +\n         'width=\"' + bbox.width + '\" height=\"' + bbox.height + '\" ' +\n         'viewBox=\"' + bbox.x + ' ' + bbox.y + ' ' + bbox.width + ' ' + bbox.height + '\" version=\"1.1\">' +\n      defs + contents +\n    '</svg>';\n  /* eslint-enable */\n\n  done(null, svg);\n};\n\nViewer.prototype.getModules = function() {\n  return this._modules;\n};\n\n/**\n * Destroy the viewer instance and remove all its\n * remainders from the document tree.\n */\nViewer.prototype.destroy = function() {\n\n  // diagram destroy\n  Diagram.prototype.destroy.call(this);\n\n  // dom detach\n  domRemove(this._container);\n};\n\n/**\n * Register an event listener\n *\n * Remove a previously added listener via {@link #off(event, callback)}.\n *\n * @param {String} event\n * @param {Number} [priority]\n * @param {Function} callback\n * @param {Object} [that]\n */\nViewer.prototype.on = function(event, priority, callback, target) {\n  return this.get('eventBus').on(event, priority, callback, target);\n};\n\n/**\n * De-register an event listener\n *\n * @param {String} event\n * @param {Function} callback\n */\nViewer.prototype.off = function(event, callback) {\n  this.get('eventBus').off(event, callback);\n};\n\n\nViewer.prototype._init = function(container, options) {\n\n  var {\n    additionalModules,\n    canvas,\n    ...additionalOptions\n  } = options;\n\n  var baseModules = options.modules || this.getModules(),\n      staticModules = [\n        {\n          drd: [ 'value', this ]\n        }\n      ];\n\n  var modules = [\n    ...staticModules,\n    ...baseModules,\n    ...(additionalModules || [])\n  ];\n\n  var diagramOptions = {\n    ...additionalOptions,\n    canvas: {\n      ...canvas,\n      container\n    },\n    modules\n  };\n\n\n  // invoke diagram constructor\n  Diagram.call(this, diagramOptions);\n\n  if (options && options.container) {\n    this.attachTo(options.container);\n  }\n};\n\n/**\n * Emit an event on the underlying {@link EventBus}\n *\n * @param  {String} type\n * @param  {Object} event\n *\n * @return {Object} event processing result (if any)\n */\nViewer.prototype._emit = function(type, event) {\n  return this.get('eventBus').fire(type, event);\n};\n\nViewer.prototype._createContainer = function() {\n  return domify(\n    '<div class=\"dmn-drd-container\"></div>'\n  );\n};\n\nViewer.prototype.open = function(definitions, done) {\n\n  var err;\n\n  // use try/catch to not swallow synchronous exceptions\n  // that may be raised during model parsing\n  try {\n\n    if (this._definitions) {\n      // clear existing rendered diagram\n      this.clear();\n    }\n\n    // update definitions\n    this._definitions = definitions;\n\n    // perform graphical import\n    return importDRD(this, definitions, done);\n  } catch (e) {\n    err = e;\n  }\n\n  return done(err);\n};\n\n/**\n * Attach viewer to given parent node.\n *\n * @param  {Element} parentNode\n */\nViewer.prototype.attachTo = function(parentNode) {\n\n  if (!parentNode) {\n    throw new Error('parentNode required');\n  }\n\n  // ensure we detach from the\n  // previous, old parent\n  this.detach();\n\n  var container = this._container;\n\n  parentNode.appendChild(container);\n\n  this._emit('attach', {});\n\n  this.get('canvas').resized();\n};\n\n/**\n * Detach viewer from parent node, if attached.\n */\nViewer.prototype.detach = function() {\n\n  var container = this._container,\n      parentNode = container.parentNode;\n\n  if (!parentNode) {\n    return;\n  }\n\n  this._emit('detach', {});\n\n  parentNode.removeChild(container);\n};\n\nimport CoreModule from './core';\nimport TranslateModule from 'diagram-js/lib/i18n/translate';\nimport SelectionModule from 'diagram-js/lib/features/selection';\nimport OverlaysModule from 'diagram-js/lib/features/overlays';\nimport DefinitionPropertiesModule from './features/definition-properties/viewer';\nimport DrillDownModule from './features/drill-down';\n\nViewer.prototype._modules = [\n  CoreModule,\n  TranslateModule,\n  SelectionModule,\n  OverlaysModule,\n  DefinitionPropertiesModule,\n  DrillDownModule\n];\n\n/* <project-logo> */\n\nimport {\n  BPMNIO_IMG,\n  open as openPoweredBy\n} from './util/PoweredByUtil';\n\nimport {\n  event as domEvent\n} from 'min-dom';\n\n/**\n * Adds the project logo to the diagram container as\n * required by the bpmn.io license.\n *\n * @see http://bpmn.io/license\n *\n * @param {Element} container\n */\nfunction addProjectLogo(container) {\n  var img = BPMNIO_IMG;\n\n  var linkMarkup =\n    '<a href=\"http://bpmn.io\" ' +\n       'target=\"_blank\" ' +\n       'class=\"bjs-powered-by\" ' +\n       'title=\"Powered by bpmn.io\" ' +\n       'style=\"position: absolute; bottom: 15px; right: 15px; z-index: 100\">' +\n      img +\n    '</a>';\n\n  var linkElement = domify(linkMarkup);\n\n  container.appendChild(linkElement);\n\n  domEvent.bind(linkElement, 'click', function(event) {\n    openPoweredBy();\n\n    event.preventDefault();\n  });\n}\n\n/* </project-logo> */\n"]}