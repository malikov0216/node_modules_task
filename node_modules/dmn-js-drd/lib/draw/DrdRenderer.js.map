{"version":3,"sources":["../../src/draw/DrdRenderer.js"],"names":["inherits","isArray","isObject","assign","attr","domAttr","query","domQuery","append","svgAppend","svgAttr","create","svgCreate","BaseRenderer","TextUtil","createLine","is","getName","DrdRenderer","eventBus","pathMap","styles","call","LABEL_STYLE","fontFamily","fontSize","textUtil","style","size","width","markers","addMarker","id","element","marker","initMarkers","svg","createMarker","options","attrs","strokeWidth","strokeLinecap","strokeDasharray","ref","x","y","scale","viewBox","refX","refY","markerWidth","markerHeight","orient","defs","associationStart","d","fill","stroke","associationEnd","informationRequirementEnd","knowledgeRequirementEnd","authorityRequirementEnd","cx","cy","r","computeStyle","custom","traits","defaultStyles","drawRect","p","height","offset","rect","rx","ry","renderLabel","label","text","createText","renderEmbeddedLabel","align","name","box","padding","drawPath","path","handlers","pathData","getScaledPath","xScaleFactor","yScaleFactor","containerWidth","containerHeight","position","mx","my","knowledgeSource","businessKnowledge","textElement","textPathData","getSemantic","semantic","strokeLinejoin","associationDirection","markerEnd","markerStart","drawLine","waypoints","drawShape","parent","h","type","prototype","apply","drawConnection","line","canRender","on","event","$inject","businessObject"],"mappings":"AAAA,OAAOA,QAAP,MAAqB,UAArB;;AAEA,SACEC,OADF,EAEEC,QAFF,EAGEC,MAHF,QAIO,UAJP;;AAMA,SACEC,QAAQC,OADV,EAEEC,SAASC,QAFX,QAGO,SAHP;;AAKA,SACEC,UAAUC,SADZ,EAEEL,QAAQM,OAFV,EAGEC,UAAUC,SAHZ,QAIO,UAJP;;AAMA,OAAOC,YAAP,MAAyB,kCAAzB;AACA,OAAOC,QAAP,MAAqB,0BAArB;;AAEA,SACEC,UADF,QAEO,gCAFP;;AAIA,SACEC,EADF,EAEEC,OAFF,QAGO,kCAHP;;AAMA,eAAe,SAASC,WAAT,CAAqBC,QAArB,EAA+BC,OAA/B,EAAwCC,MAAxC,EAAgD;;AAE7DR,eAAaS,IAAb,CAAkB,IAAlB,EAAwBH,QAAxB;;AAEA,MAAII,cAAc;AAChBC,gBAAY,mBADI;AAEhBC,cAAU;AAFM,GAAlB;;AAKA,MAAIC,WAAW,IAAIZ,QAAJ,CAAa;AAC1Ba,WAAOJ,WADmB;AAE1BK,UAAM,EAAEC,OAAO,GAAT;AAFoB,GAAb,CAAf;;AAKA,MAAIC,UAAU,EAAd;;AAEA,WAASC,SAAT,CAAmBC,EAAnB,EAAuBC,OAAvB,EAAgC;AAC9BH,YAAQE,EAAR,IAAcC,OAAd;AACD;;AAED,WAASC,MAAT,CAAgBF,EAAhB,EAAoB;AAClB,QAAIE,SAASJ,QAAQE,EAAR,CAAb;;AAEA,WAAO,UAAUE,OAAOF,EAAjB,GAAsB,GAA7B;AACD;;AAED,WAASG,WAAT,CAAqBC,GAArB,EAA0B;;AAExB,aAASC,YAAT,CAAsBL,EAAtB,EAA0BM,OAA1B,EAAmC;AACjC,UAAIC,QAAQpC,OAAO;AACjBqC,qBAAa,CADI;AAEjBC,uBAAe,OAFE;AAGjBC,yBAAiB;AAHA,OAAP,EAITJ,QAAQC,KAJC,CAAZ;;AAMA,UAAII,MAAML,QAAQK,GAAR,IAAe,EAAEC,GAAG,CAAL,EAAQC,GAAG,CAAX,EAAzB;;AAEA,UAAIC,QAAQR,QAAQQ,KAAR,IAAiB,CAA7B;;AAEA;AACA;AACA,UAAIP,MAAMG,eAAN,KAA0B,MAA9B,EAAsC;AACpCH,cAAMG,eAAN,GAAwB,CAAC,KAAD,EAAQ,CAAR,CAAxB;AACD;;AAED,UAAIR,SAAStB,UAAU,QAAV,CAAb;;AAEAF,cAAQ4B,QAAQL,OAAhB,EAAyBM,KAAzB;;AAEA9B,gBAAUyB,MAAV,EAAkBI,QAAQL,OAA1B;;AAEAvB,cAAQwB,MAAR,EAAgB;AACdF,YAAIA,EADU;AAEde,iBAAS,WAFK;AAGdC,cAAML,IAAIC,CAHI;AAIdK,cAAMN,IAAIE,CAJI;AAKdK,qBAAa,KAAKJ,KALJ;AAMdK,sBAAc,KAAKL,KANL;AAOdM,gBAAQ;AAPM,OAAhB;;AAUA,UAAIC,OAAO9C,SAAS,MAAT,EAAiB6B,GAAjB,CAAX;;AAEA,UAAI,CAACiB,IAAL,EAAW;AACTA,eAAOzC,UAAU,MAAV,CAAP;;AAEAH,kBAAU2B,GAAV,EAAeiB,IAAf;AACD;;AAED5C,gBAAU4C,IAAV,EAAgBnB,MAAhB;;AAEA,aAAOH,UAAUC,EAAV,EAAcE,MAAd,CAAP;AACD;;AAED,QAAIoB,mBAAmB1C,UAAU,MAAV,CAAvB;AACAF,YAAQ4C,gBAAR,EAA0B,EAAEC,GAAG,uBAAL,EAA1B;;AAEAlB,iBAAa,mBAAb,EAAkC;AAChCJ,eAASqB,gBADuB;AAEhCf,aAAO;AACLiB,cAAM,MADD;AAELC,gBAAQ,OAFH;AAGLjB,qBAAa;AAHR,OAFyB;AAOhCG,WAAK,EAAEC,GAAG,CAAL,EAAQC,GAAG,EAAX,EAP2B;AAQhCC,aAAO;AARyB,KAAlC;;AAWA,QAAIY,iBAAiB9C,UAAU,MAAV,CAArB;AACAF,YAAQgD,cAAR,EAAwB,EAAEH,GAAG,sBAAL,EAAxB;;AAEAlB,iBAAa,iBAAb,EAAgC;AAC9BJ,eAASyB,cADqB;AAE9BnB,aAAO;AACLiB,cAAM,MADD;AAELC,gBAAQ,OAFH;AAGLjB,qBAAa;AAHR,OAFuB;AAO9BG,WAAK,EAAEC,GAAG,EAAL,EAASC,GAAG,EAAZ,EAPyB;AAQ9BC,aAAO;AARuB,KAAhC;;AAWA,QAAIa,4BAA4B/C,UAAU,MAAV,CAAhC;AACAF,YAAQiD,yBAAR,EAAmC,EAAEJ,GAAG,wBAAL,EAAnC;;AAEAlB,iBAAa,6BAAb,EAA4C;AAC1CJ,eAAS0B,yBADiC;AAE1ChB,WAAK,EAAEC,GAAG,EAAL,EAASC,GAAG,EAAZ,EAFqC;AAG1CC,aAAO;AAHmC,KAA5C;;AAMA,QAAIc,0BAA0BhD,UAAU,MAAV,CAA9B;AACAF,YAAQkD,uBAAR,EAAiC,EAAEL,GAAG,sBAAL,EAAjC;;AAEAlB,iBAAa,2BAAb,EAA0C;AACxCJ,eAAS2B,uBAD+B;AAExCrB,aAAO;AACLiB,cAAM,MADD;AAELC,gBAAQ,OAFH;AAGLjB,qBAAa;AAHR,OAFiC;AAOxCG,WAAK,EAAEC,GAAG,EAAL,EAASC,GAAG,EAAZ,EAPmC;AAQxCC,aAAO;AARiC,KAA1C;;AAWA,QAAIe,0BAA0BjD,UAAU,QAAV,CAA9B;AACAF,YAAQmD,uBAAR,EAAiC,EAAEC,IAAI,CAAN,EAASC,IAAI,CAAb,EAAgBC,GAAG,CAAnB,EAAjC;;AAEA3B,iBAAa,2BAAb,EAA0C;AACxCJ,eAAS4B,uBAD+B;AAExClB,WAAK,EAAEC,GAAG,CAAL,EAAQC,GAAG,CAAX,EAFmC;AAGxCC,aAAO;AAHiC,KAA1C;AAKD;;AAED,WAASmB,YAAT,CAAsBC,MAAtB,EAA8BC,MAA9B,EAAsCC,aAAtC,EAAqD;AACnD,QAAI,CAACnE,QAAQkE,MAAR,CAAL,EAAsB;AACpBC,sBAAgBD,MAAhB;AACAA,eAAS,EAAT;AACD;;AAED,WAAO9C,OAAOM,KAAP,CAAawC,UAAU,EAAvB,EAA2BhE,OAAOiE,aAAP,EAAsBF,UAAU,EAAhC,CAA3B,CAAP;AACD;;AAGD,WAASG,QAAT,CAAkBC,CAAlB,EAAqBzC,KAArB,EAA4B0C,MAA5B,EAAoCP,CAApC,EAAuCQ,MAAvC,EAA+CjC,KAA/C,EAAsD;;AAEpD,QAAIrC,SAASsE,MAAT,CAAJ,EAAsB;AACpBjC,cAAQiC,MAAR;AACAA,eAAS,CAAT;AACD;;AAEDA,aAASA,UAAU,CAAnB;;AAEAjC,YAAQ0B,aAAa1B,KAAb,EAAoB;AAC1BkB,cAAQ,OADkB;AAE1BjB,mBAAa,CAFa;AAG1BgB,YAAM;AAHoB,KAApB,CAAR;;AAMA,QAAIiB,OAAO7D,UAAU,MAAV,CAAX;AACAF,YAAQ+D,IAAR,EAAc;AACZ7B,SAAG4B,MADS;AAEZ3B,SAAG2B,MAFS;AAGZ3C,aAAOA,QAAQ2C,SAAS,CAHZ;AAIZD,cAAQA,SAASC,SAAS,CAJd;AAKZE,UAAIV,CALQ;AAMZW,UAAIX;AANQ,KAAd;AAQAtD,YAAQ+D,IAAR,EAAclC,KAAd;;AAEA9B,cAAU6D,CAAV,EAAaG,IAAb;;AAEA,WAAOA,IAAP;AACD;;AAED,WAASG,WAAT,CAAqBN,CAArB,EAAwBO,KAAxB,EAA+BvC,OAA/B,EAAwC;AACtC,QAAIwC,OAAOpD,SAASqD,UAAT,CAAoBF,SAAS,EAA7B,EAAiCvC,OAAjC,CAAX;;AAEAjC,YAAQyE,IAAR,EAAc,OAAd,EAAuB,WAAvB;;AAEArE,cAAU6D,CAAV,EAAaQ,IAAb;;AAEA,WAAOA,IAAP;AACD;;AAED,WAASE,mBAAT,CAA6BV,CAA7B,EAAgCrC,OAAhC,EAAyCgD,KAAzC,EAAgD;AAC9C,QAAIC,OAAOjE,QAAQgB,OAAR,CAAX;AACA,WAAO2C,YAAYN,CAAZ,EAAeY,IAAf,EAAqB,EAAEC,KAAKlD,OAAP,EAAgBgD,OAAOA,KAAvB,EAA8BG,SAAS,CAAvC,EAArB,CAAP;AACD;;AAED,WAASC,QAAT,CAAkBf,CAAlB,EAAqBf,CAArB,EAAwBhB,KAAxB,EAA+B;;AAE7BA,YAAQ0B,aAAa1B,KAAb,EAAoB,CAAE,SAAF,CAApB,EAAmC;AACzCC,mBAAa,CAD4B;AAEzCiB,cAAQ;AAFiC,KAAnC,CAAR;;AAKA,QAAI6B,OAAO1E,UAAU,MAAV,CAAX;AACAF,YAAQ4E,IAAR,EAAc,EAAE/B,GAAGA,CAAL,EAAd;AACA7C,YAAQ4E,IAAR,EAAc/C,KAAd;;AAEA9B,cAAU6D,CAAV,EAAagB,IAAb;;AAEA,WAAOA,IAAP;AACD;;AAGD,MAAIC,WAAW;AACb,oBAAgB,qBAASjB,CAAT,EAAYrC,OAAZ,EAAqBM,KAArB,EAA4B;AAC1C,UAAIkC,OAAOJ,SAASC,CAAT,EAAYrC,QAAQJ,KAApB,EAA2BI,QAAQsC,MAAnC,EAA2C,CAA3C,EAA8ChC,KAA9C,CAAX;;AAEAyC,0BAAoBV,CAApB,EAAuBrC,OAAvB,EAAgC,eAAhC;;AAEA,aAAOwC,IAAP;AACD,KAPY;AAQb,2BAAuB,4BAASH,CAAT,EAAYrC,OAAZ,EAAqBM,KAArB,EAA4B;;AAEjD,UAAIiD,WAAWpE,QAAQqE,aAAR,CAAsB,kBAAtB,EAA0C;AACvDC,sBAAc,KADyC;AAEvDC,sBAAc,CAFyC;AAGvDC,wBAAgB3D,QAAQJ,KAH+B;AAIvDgE,yBAAiB5D,QAAQsC,MAJ8B;AAKvDuB,kBAAU;AACRC,cAAI,GADI;AAERC,cAAI;AAFI;AAL6C,OAA1C,CAAf;;AAWA,UAAIC,kBAAkBZ,SAASf,CAAT,EAAYkB,QAAZ,EAAsB;AAC1ChD,qBAAa,CAD6B;AAE1CgB,cAAM,OAFoC;AAG1CC,gBAAQ;AAHkC,OAAtB,CAAtB;;AAMAuB,0BAAoBV,CAApB,EAAuBrC,OAAvB,EAAgC,eAAhC;;AAEA,aAAOgE,eAAP;AACD,KA9BY;AA+Bb,kCAA8B,mCAAS3B,CAAT,EAAYrC,OAAZ,EAAqBM,KAArB,EAA4B;;AAExD,UAAIiD,WAAWpE,QAAQqE,aAAR,CAAsB,0BAAtB,EAAkD;AAC/DC,sBAAc,CADiD;AAE/DC,sBAAc,CAFiD;AAG/DC,wBAAgB3D,QAAQJ,KAHuC;AAI/DgE,yBAAiB5D,QAAQsC,MAJsC;AAK/DuB,kBAAU;AACRC,cAAI,GADI;AAERC,cAAI;AAFI;AALqD,OAAlD,CAAf;;AAWA,UAAIE,oBAAoBb,SAASf,CAAT,EAAYkB,QAAZ,EAAsB;AAC5ChD,qBAAa,CAD+B;AAE5CgB,cAAM,OAFsC;AAG5CC,gBAAQ;AAHoC,OAAtB,CAAxB;;AAMAuB,0BAAoBV,CAApB,EAAuBrC,OAAvB,EAAgC,eAAhC;;AAEA,aAAOiE,iBAAP;AACD,KArDY;AAsDb,qBAAiB,sBAAS5B,CAAT,EAAYrC,OAAZ,EAAqBM,KAArB,EAA4B;;AAE3C,UAAIkC,OAAOJ,SAASC,CAAT,EAAYrC,QAAQJ,KAApB,EAA2BI,QAAQsC,MAAnC,EAA2C,EAA3C,EAA+ChC,KAA/C,CAAX;;AAEAyC,0BAAoBV,CAApB,EAAuBrC,OAAvB,EAAgC,eAAhC;;AAEA,aAAOwC,IAAP;AACD,KA7DY;AA8Db,0BAAsB,2BAASH,CAAT,EAAYrC,OAAZ,EAAqBM,KAArB,EAA4B;AAChD,UAAIZ,QAAQ;AACV,gBAAQ,MADE;AAEV,kBAAU;AAFA,OAAZ;AAIA,UAAIwE,cAAc9B,SAASC,CAAT,EAAYrC,QAAQJ,KAApB,EAA2BI,QAAQsC,MAAnC,EAA2C,CAA3C,EAA8C,CAA9C,EAAiD5C,KAAjD,CAAlB;AAAA,UACIyE,eAAehF,QAAQqE,aAAR,CAAsB,iBAAtB,EAAyC;AACtDC,sBAAc,CADwC;AAEtDC,sBAAc,CAFwC;AAGtDC,wBAAgB3D,QAAQJ,KAH8B;AAItDgE,yBAAiB5D,QAAQsC,MAJ6B;AAKtDuB,kBAAU;AACRC,cAAI,GADI;AAERC,cAAI;AAFI;AAL4C,OAAzC,CADnB;;AAYAX,eAASf,CAAT,EAAY8B,YAAZ;;AAEA,UAAItB,OAAOuB,YAAYpE,OAAZ,EAAqB6C,IAArB,IAA6B,EAAxC;;AAEAF,kBAAYN,CAAZ,EAAeQ,IAAf,EAAqB,EAAEK,KAAKlD,OAAP,EAAgBgD,OAAO,aAAvB,EAAsCG,SAAS,CAA/C,EAArB;;AAEA,aAAOe,WAAP;AACD,KAtFY;AAuFb,uBAAmB,wBAAS7B,CAAT,EAAYrC,OAAZ,EAAqBM,KAArB,EAA4B;AAC7C,UAAI+D,WAAWD,YAAYpE,OAAZ,CAAf;;AAEAM,cAAQpC,OAAO;AACbuC,yBAAiB,QADJ;AAEbD,uBAAe,OAFF;AAGb8D,wBAAgB,OAHH;AAIb/C,cAAM;AAJO,OAAP,EAKLjB,SAAS,EALJ,CAAR;;AAOA,UAAI+D,SAASE,oBAAT,KAAkC,KAAlC,IACAF,SAASE,oBAAT,KAAkC,MADtC,EAC8C;AAC5CjE,cAAMkE,SAAN,GAAkBvE,OAAO,iBAAP,CAAlB;AACD;;AAED,UAAIoE,SAASE,oBAAT,KAAkC,MAAtC,EAA8C;AAC5CjE,cAAMmE,WAAN,GAAoBxE,OAAO,mBAAP,CAApB;AACD;;AAED,aAAOyE,SAASrC,CAAT,EAAYrC,QAAQ2E,SAApB,EAA+BrE,KAA/B,CAAP;AACD,KA3GY;AA4Gb,kCAA8B,mCAAS+B,CAAT,EAAYrC,OAAZ,EAAqBM,KAArB,EAA4B;;AAExDA,cAAQpC,OAAO;AACbqC,qBAAa,CADA;AAEbC,uBAAe,OAFF;AAGb8D,wBAAgB,OAHH;AAIbE,mBAAWvE,OAAO,6BAAP;AAJE,OAAP,EAKLK,SAAS,EALJ,CAAR;;AAOA,aAAOoE,SAASrC,CAAT,EAAYrC,QAAQ2E,SAApB,EAA+BrE,KAA/B,CAAP;AACD,KAtHY;AAuHb,gCAA4B,iCAAS+B,CAAT,EAAYrC,OAAZ,EAAqBM,KAArB,EAA4B;;AAEtDA,cAAQpC,OAAO;AACbqC,qBAAa,CADA;AAEbE,yBAAiB,CAFJ;AAGbD,uBAAe,OAHF;AAIb8D,wBAAgB,OAJH;AAKbE,mBAAWvE,OAAO,2BAAP;AALE,OAAP,EAMLK,SAAS,EANJ,CAAR;;AAQA,aAAOoE,SAASrC,CAAT,EAAYrC,QAAQ2E,SAApB,EAA+BrE,KAA/B,CAAP;AACD,KAlIY;AAmIb,gCAA4B,iCAAS+B,CAAT,EAAYrC,OAAZ,EAAqBM,KAArB,EAA4B;;AAEtDA,cAAQpC,OAAO;AACbqC,qBAAa,GADA;AAEbE,yBAAiB,CAFJ;AAGbD,uBAAe,OAHF;AAIb8D,wBAAgB,OAJH;AAKbE,mBAAWvE,OAAO,2BAAP;AALE,OAAP,EAMLK,SAAS,EANJ,CAAR;;AAQA,aAAOoE,SAASrC,CAAT,EAAYrC,QAAQ2E,SAApB,EAA+BrE,KAA/B,CAAP;AACD;AA9IY,GAAf;;AAkJA;;AAEA,WAASsE,SAAT,CAAmBC,MAAnB,EAA2B7E,OAA3B,EAAoC;AAClC,QAAI8E,IAAIxB,SAAStD,QAAQ+E,IAAjB,CAAR;;AAEA,QAAI,CAACD,CAAL,EAAQ;AACN,aAAOlG,aAAaoG,SAAb,CAAuBJ,SAAvB,CAAiCK,KAAjC,CAAuC,IAAvC,EAA6C,CAAEJ,MAAF,EAAU7E,OAAV,CAA7C,CAAP;AACD,KAFD,MAEO;AACL,aAAO8E,EAAED,MAAF,EAAU7E,OAAV,CAAP;AACD;AACF;;AAED,WAASkF,cAAT,CAAwBL,MAAxB,EAAgC7E,OAAhC,EAAyC;AACvC,QAAI+E,OAAO/E,QAAQ+E,IAAnB;AACA,QAAID,IAAIxB,SAASyB,IAAT,CAAR;;AAEA,QAAI,CAACD,CAAL,EAAQ;AACN,aAAOlG,aAAaoG,SAAb,CAAuBE,cAAvB,CAAsCD,KAAtC,CAA4C,IAA5C,EAAkD,CAAEJ,MAAF,EAAU7E,OAAV,CAAlD,CAAP;AACD,KAFD,MAEO;AACL,aAAO8E,EAAED,MAAF,EAAU7E,OAAV,CAAP;AACD;AACF;;AAED,WAAS0E,QAAT,CAAkBrC,CAAlB,EAAqBsC,SAArB,EAAgCrE,KAAhC,EAAuC;AACrCA,YAAQ0B,aAAa1B,KAAb,EAAoB,CAAE,SAAF,CAApB,EAAmC;AACzCkB,cAAQ,OADiC;AAEzCjB,mBAAa,CAF4B;AAGzCgB,YAAM;AAHmC,KAAnC,CAAR;;AAMA,QAAI4D,OAAOrG,WAAW6F,SAAX,EAAsBrE,KAAtB,CAAX;;AAEA9B,cAAU6D,CAAV,EAAa8C,IAAb;;AAEA,WAAOA,IAAP;AACD;;AAED,OAAKC,SAAL,GAAiB,UAASpF,OAAT,EAAkB;AACjC,WAAOjB,GAAGiB,OAAH,EAAY,gBAAZ,KACAjB,GAAGiB,OAAH,EAAY,4BAAZ,CADA,IAEAjB,GAAGiB,OAAH,EAAY,0BAAZ,CAFA,IAGAjB,GAAGiB,OAAH,EAAY,0BAAZ,CAHP;AAID,GALD;;AAOA,OAAK4E,SAAL,GAAiBA,SAAjB;AACA,OAAKM,cAAL,GAAsBA,cAAtB;;AAGA;AACA;AACAhG,WAASmG,EAAT,CAAY,aAAZ,EAA2B,UAASC,KAAT,EAAgB;AACzCpF,gBAAYoF,MAAMnF,GAAlB;AACD,GAFD;AAID;;AAEDpC,SAASkB,WAAT,EAAsBL,YAAtB;;AAEAK,YAAYsG,OAAZ,GAAsB,CACpB,UADoB,EAEpB,SAFoB,EAGpB,QAHoB,CAAtB;;AAOA;;AAEA,SAASnB,WAAT,CAAqBpE,OAArB,EAA8B;AAC5B,SAAOA,QAAQwF,cAAf;AACD","file":"DrdRenderer.js","sourcesContent":["import inherits from 'inherits';\n\nimport {\n  isArray,\n  isObject,\n  assign\n} from 'min-dash';\n\nimport {\n  attr as domAttr,\n  query as domQuery\n} from 'min-dom';\n\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  create as svgCreate\n} from 'tiny-svg';\n\nimport BaseRenderer from 'diagram-js/lib/draw/BaseRenderer';\nimport TextUtil from 'diagram-js/lib/util/Text';\n\nimport {\n  createLine\n} from 'diagram-js/lib/util/RenderUtil';\n\nimport {\n  is,\n  getName\n} from 'dmn-js-shared/lib/util/ModelUtil';\n\n\nexport default function DrdRenderer(eventBus, pathMap, styles) {\n\n  BaseRenderer.call(this, eventBus);\n\n  var LABEL_STYLE = {\n    fontFamily: 'Arial, sans-serif',\n    fontSize: '12px'\n  };\n\n  var textUtil = new TextUtil({\n    style: LABEL_STYLE,\n    size: { width: 100 }\n  });\n\n  var markers = {};\n\n  function addMarker(id, element) {\n    markers[id] = element;\n  }\n\n  function marker(id) {\n    var marker = markers[id];\n\n    return 'url(#' + marker.id + ')';\n  }\n\n  function initMarkers(svg) {\n\n    function createMarker(id, options) {\n      var attrs = assign({\n        strokeWidth: 1,\n        strokeLinecap: 'round',\n        strokeDasharray: 'none'\n      }, options.attrs);\n\n      var ref = options.ref || { x: 0, y: 0 };\n\n      var scale = options.scale || 1;\n\n      // fix for safari / chrome / firefox bug not correctly\n      // resetting stroke dash array\n      if (attrs.strokeDasharray === 'none') {\n        attrs.strokeDasharray = [10000, 1];\n      }\n\n      var marker = svgCreate('marker');\n\n      svgAttr(options.element, attrs);\n\n      svgAppend(marker, options.element);\n\n      svgAttr(marker, {\n        id: id,\n        viewBox: '0 0 20 20',\n        refX: ref.x,\n        refY: ref.y,\n        markerWidth: 20 * scale,\n        markerHeight: 20 * scale,\n        orient: 'auto'\n      });\n\n      var defs = domQuery('defs', svg);\n\n      if (!defs) {\n        defs = svgCreate('defs');\n\n        svgAppend(svg, defs);\n      }\n\n      svgAppend(defs, marker);\n\n      return addMarker(id, marker);\n    }\n\n    var associationStart = svgCreate('path');\n    svgAttr(associationStart, { d: 'M 11 5 L 1 10 L 11 15' });\n\n    createMarker('association-start', {\n      element: associationStart,\n      attrs: {\n        fill: 'none',\n        stroke: 'black',\n        strokeWidth: 1.5\n      },\n      ref: { x: 1, y: 10 },\n      scale: 0.5\n    });\n\n    var associationEnd = svgCreate('path');\n    svgAttr(associationEnd, { d: 'M 1 5 L 11 10 L 1 15' });\n\n    createMarker('association-end', {\n      element: associationEnd,\n      attrs: {\n        fill: 'none',\n        stroke: 'black',\n        strokeWidth: 1.5\n      },\n      ref: { x: 12, y: 10 },\n      scale: 0.5\n    });\n\n    var informationRequirementEnd = svgCreate('path');\n    svgAttr(informationRequirementEnd, { d: 'M 1 5 L 11 10 L 1 15 Z' });\n\n    createMarker('information-requirement-end', {\n      element: informationRequirementEnd,\n      ref: { x: 11, y: 10 },\n      scale: 1\n    });\n\n    var knowledgeRequirementEnd = svgCreate('path');\n    svgAttr(knowledgeRequirementEnd, { d: 'M 1 3 L 11 10 L 1 17' });\n\n    createMarker('knowledge-requirement-end', {\n      element: knowledgeRequirementEnd,\n      attrs: {\n        fill: 'none',\n        stroke: 'black',\n        strokeWidth: 2\n      },\n      ref: { x: 11, y: 10 },\n      scale: 0.8\n    });\n\n    var authorityRequirementEnd = svgCreate('circle');\n    svgAttr(authorityRequirementEnd, { cx: 3, cy: 3, r: 3 });\n\n    createMarker('authority-requirement-end', {\n      element: authorityRequirementEnd,\n      ref: { x: 3, y: 3 },\n      scale: 0.9\n    });\n  }\n\n  function computeStyle(custom, traits, defaultStyles) {\n    if (!isArray(traits)) {\n      defaultStyles = traits;\n      traits = [];\n    }\n\n    return styles.style(traits || [], assign(defaultStyles, custom || {}));\n  }\n\n\n  function drawRect(p, width, height, r, offset, attrs) {\n\n    if (isObject(offset)) {\n      attrs = offset;\n      offset = 0;\n    }\n\n    offset = offset || 0;\n\n    attrs = computeStyle(attrs, {\n      stroke: 'black',\n      strokeWidth: 2,\n      fill: 'white'\n    });\n\n    var rect = svgCreate('rect');\n    svgAttr(rect, {\n      x: offset,\n      y: offset,\n      width: width - offset * 2,\n      height: height - offset * 2,\n      rx: r,\n      ry: r\n    });\n    svgAttr(rect, attrs);\n\n    svgAppend(p, rect);\n\n    return rect;\n  }\n\n  function renderLabel(p, label, options) {\n    var text = textUtil.createText(label || '', options);\n\n    domAttr(text, 'class', 'djs-label');\n\n    svgAppend(p, text);\n\n    return text;\n  }\n\n  function renderEmbeddedLabel(p, element, align) {\n    var name = getName(element);\n    return renderLabel(p, name, { box: element, align: align, padding: 5 });\n  }\n\n  function drawPath(p, d, attrs) {\n\n    attrs = computeStyle(attrs, [ 'no-fill' ], {\n      strokeWidth: 2,\n      stroke: 'black'\n    });\n\n    var path = svgCreate('path');\n    svgAttr(path, { d: d });\n    svgAttr(path, attrs);\n\n    svgAppend(p, path);\n\n    return path;\n  }\n\n\n  var handlers = {\n    'dmn:Decision': function(p, element, attrs) {\n      var rect = drawRect(p, element.width, element.height, 0, attrs);\n\n      renderEmbeddedLabel(p, element, 'center-middle');\n\n      return rect;\n    },\n    'dmn:KnowledgeSource': function(p, element, attrs) {\n\n      var pathData = pathMap.getScaledPath('KNOWLEDGE_SOURCE', {\n        xScaleFactor: 1.021,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.0,\n          my: 0.075\n        }\n      });\n\n      var knowledgeSource = drawPath(p, pathData, {\n        strokeWidth: 2,\n        fill: 'white',\n        stroke: 'black'\n      });\n\n      renderEmbeddedLabel(p, element, 'center-middle');\n\n      return knowledgeSource;\n    },\n    'dmn:BusinessKnowledgeModel': function(p, element, attrs) {\n\n      var pathData = pathMap.getScaledPath('BUSINESS_KNOWLEDGE_MODEL', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.0,\n          my: 0.3\n        }\n      });\n\n      var businessKnowledge = drawPath(p, pathData, {\n        strokeWidth: 2,\n        fill: 'white',\n        stroke: 'black'\n      });\n\n      renderEmbeddedLabel(p, element, 'center-middle');\n\n      return businessKnowledge;\n    },\n    'dmn:InputData': function(p, element, attrs) {\n\n      var rect = drawRect(p, element.width, element.height, 22, attrs);\n\n      renderEmbeddedLabel(p, element, 'center-middle');\n\n      return rect;\n    },\n    'dmn:TextAnnotation': function(p, element, attrs) {\n      var style = {\n        'fill': 'none',\n        'stroke': 'none'\n      };\n      var textElement = drawRect(p, element.width, element.height, 0, 0, style),\n          textPathData = pathMap.getScaledPath('TEXT_ANNOTATION', {\n            xScaleFactor: 1,\n            yScaleFactor: 1,\n            containerWidth: element.width,\n            containerHeight: element.height,\n            position: {\n              mx: 0.0,\n              my: 0.0\n            }\n          });\n\n      drawPath(p, textPathData);\n\n      var text = getSemantic(element).text || '';\n\n      renderLabel(p, text, { box: element, align: 'left-middle', padding: 5 });\n\n      return textElement;\n    },\n    'dmn:Association': function(p, element, attrs) {\n      var semantic = getSemantic(element);\n\n      attrs = assign({\n        strokeDasharray: '0.5, 5',\n        strokeLinecap: 'round',\n        strokeLinejoin: 'round',\n        fill: 'none'\n      }, attrs || {});\n\n      if (semantic.associationDirection === 'One' ||\n          semantic.associationDirection === 'Both') {\n        attrs.markerEnd = marker('association-end');\n      }\n\n      if (semantic.associationDirection === 'Both') {\n        attrs.markerStart = marker('association-start');\n      }\n\n      return drawLine(p, element.waypoints, attrs);\n    },\n    'dmn:InformationRequirement': function(p, element, attrs) {\n\n      attrs = assign({\n        strokeWidth: 1,\n        strokeLinecap: 'round',\n        strokeLinejoin: 'round',\n        markerEnd: marker('information-requirement-end')\n      }, attrs || {});\n\n      return drawLine(p, element.waypoints, attrs);\n    },\n    'dmn:KnowledgeRequirement': function(p, element, attrs) {\n\n      attrs = assign({\n        strokeWidth: 1,\n        strokeDasharray: 5,\n        strokeLinecap: 'round',\n        strokeLinejoin: 'round',\n        markerEnd: marker('knowledge-requirement-end')\n      }, attrs || {});\n\n      return drawLine(p, element.waypoints, attrs);\n    },\n    'dmn:AuthorityRequirement': function(p, element, attrs) {\n\n      attrs = assign({\n        strokeWidth: 1.5,\n        strokeDasharray: 5,\n        strokeLinecap: 'round',\n        strokeLinejoin: 'round',\n        markerEnd: marker('authority-requirement-end')\n      }, attrs || {});\n\n      return drawLine(p, element.waypoints, attrs);\n    }\n  };\n\n\n  // draw shape and connection //////////////////\n\n  function drawShape(parent, element) {\n    var h = handlers[element.type];\n\n    if (!h) {\n      return BaseRenderer.prototype.drawShape.apply(this, [ parent, element ]);\n    } else {\n      return h(parent, element);\n    }\n  }\n\n  function drawConnection(parent, element) {\n    var type = element.type;\n    var h = handlers[type];\n\n    if (!h) {\n      return BaseRenderer.prototype.drawConnection.apply(this, [ parent, element ]);\n    } else {\n      return h(parent, element);\n    }\n  }\n\n  function drawLine(p, waypoints, attrs) {\n    attrs = computeStyle(attrs, [ 'no-fill' ], {\n      stroke: 'black',\n      strokeWidth: 2,\n      fill: 'none'\n    });\n\n    var line = createLine(waypoints, attrs);\n\n    svgAppend(p, line);\n\n    return line;\n  }\n\n  this.canRender = function(element) {\n    return is(element, 'dmn:DMNElement') ||\n           is(element, 'dmn:InformationRequirement') ||\n           is(element, 'dmn:KnowledgeRequirement') ||\n           is(element, 'dmn:AuthorityRequirement');\n  };\n\n  this.drawShape = drawShape;\n  this.drawConnection = drawConnection;\n\n\n  // hook onto canvas init event to initialize\n  // connection start/end markers on svg\n  eventBus.on('canvas.init', function(event) {\n    initMarkers(event.svg);\n  });\n\n}\n\ninherits(DrdRenderer, BaseRenderer);\n\nDrdRenderer.$inject = [\n  'eventBus',\n  'pathMap',\n  'styles'\n];\n\n\n// helper functions //////////////////////\n\nfunction getSemantic(element) {\n  return element.businessObject;\n}\n"]}