{"version":3,"sources":["../../src/import/DrdTreeWalker.js"],"names":["forEach","find","matchPattern","is","parseID","element","href","slice","DRDTreeWalker","handler","options","deferred","visit","di","gfx","Error","id","handleDefinitions","definitions","root","handleElement","handleDeferred","elements","d","edges","handleDI","extensionElement","push","handleConnections","deferConnection","semantic","property","edge","source","sourceRef","requirements","requirement","properties","fn","extensionElements","values"],"mappings":"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","file":"DrdTreeWalker.js","sourcesContent":["import {\n  forEach,\n  find,\n  matchPattern\n} from 'min-dash';\n\nimport {\n  is\n} from 'dmn-js-shared/lib/util/ModelUtil';\n\nfunction parseID(element) {\n  return element && element.href.slice(1);\n}\n\nexport default function DRDTreeWalker(handler, options) {\n\n  // list of elements to handle deferred to ensure\n  // prerequisites are drawn\n  var deferred = [];\n\n  function visit(element, di) {\n\n    var gfx = element.gfx;\n\n    // avoid multiple rendering of elements\n    if (gfx) {\n      throw new Error('already rendered ' + element.id);\n    }\n\n    // call handler\n    return handler.element(element, di);\n  }\n\n\n  // Semantic handling //////////////////////\n\n  function handleDefinitions(definitions) {\n\n    // make sure we walk the correct dmnElement\n    handler.root(definitions);\n\n    forEach(['decision', 'drgElements', 'artifacts' ], function(element) {\n      if (definitions[element]) {\n        forEach(definitions[element], handleElement);\n      }\n    });\n\n    handleDeferred(deferred);\n  }\n\n  function handleDeferred(elements) {\n    forEach(elements, function(d) {\n      d();\n    });\n  }\n\n  function handleElement(element) {\n    var edges = [];\n\n    handleDI(element, function(extensionElement) {\n      if (is(extensionElement, 'biodi:Bounds')) {\n        visit(element, extensionElement);\n\n      } else if (is(extensionElement, 'biodi:Edge')) {\n        edges.push(extensionElement);\n      }\n    });\n\n    handleConnections(edges, element);\n  }\n\n\n\n  function handleConnections(edges, element) {\n\n    function deferConnection(semantic, property) {\n      var id = parseID(property),\n          edge = find(edges, matchPattern({ source: id }));\n\n      if (edge) {\n        deferred.push(function() {\n          visit(semantic, edge);\n        });\n      }\n    }\n\n    if (is(element, 'dmn:Association')) {\n      return deferConnection(element, element.sourceRef);\n    }\n\n    forEach([\n      'informationRequirement',\n      'knowledgeRequirement',\n      'authorityRequirement'\n    ], function(requirements) {\n      forEach(element[requirements], function(requirement) {\n        var properties = null;\n\n        // get the href\n        if (is(requirement, 'dmn:InformationRequirement')) {\n          properties = [ 'requiredDecision', 'requiredInput' ];\n\n        } else if (is(requirement, 'dmn:KnowledgeRequirement')) {\n          properties = [ 'requiredKnowledge' ];\n\n        } else if (is(requirement, 'dmn:AuthorityRequirement')) {\n          properties = [ 'requiredDecision', 'requiredInput', 'requiredAuthority' ];\n        }\n\n        if (properties) {\n          forEach(properties, function(property) {\n            if (requirement[property]) {\n              deferConnection(requirement, requirement[property]);\n            }\n          });\n        }\n      });\n    });\n  }\n\n  function handleDI(element, fn) {\n    var extensionElements = element.extensionElements;\n\n    if (!extensionElements) {\n      return;\n    }\n\n    forEach(extensionElements.values, fn);\n  }\n\n\n  // API //////////////////////\n\n  return {\n    handleDefinitions: handleDefinitions\n  };\n}\n"]}