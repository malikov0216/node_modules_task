{"version":3,"sources":["../../../../src/base/viewer/core/Components.js"],"names":["isFunction","isNumber","DEFAULT_PRIORITY","Components","_listeners","type","context","listeners","component","i","length","callback","components","push","priority","Error","_getListeners","existingListener","idx","newListener","splice","listener","listenerCallback"],"mappings":";;;;AAAA,SACEA,UADF,EAEEC,QAFF,QAGO,UAHP;;AAKA,IAAMC,mBAAmB,IAAzB;;IAGqBC,U;AAEnB,wBAAc;AAAA;;AACZ,SAAKC,UAAL,GAAkB,EAAlB;AACD;;;;iCAEYC,I,EAAMC,O,EAAS;AAC1B,UAAMC,YAAY,KAAKH,UAAL,CAAgBC,IAAhB,CAAlB;;AAEA,UAAI,CAACE,SAAL,EAAgB;AACd;AACD;;AAED,UAAIC,kBAAJ;;AAEA,WAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIF,UAAUG,MAA9B,EAAsCD,GAAtC,EAA2C;AACzCD,oBAAYD,UAAUE,CAAV,EAAaE,QAAb,CAAsBL,OAAtB,CAAZ;;AAEA,YAAIE,SAAJ,EAAe;AACb;AACD;AACF;;AAED,aAAOA,SAAP;AACD;;;kCAEaH,I,EAAMC,O,EAAS;AAC3B,UAAMC,YAAY,KAAKH,UAAL,CAAgBC,IAAhB,CAAlB;;AAEA,UAAI,CAACE,SAAL,EAAgB;AACd;AACD;;AAED,UAAMK,aAAa,EAAnB;;AAEA,WAAK,IAAIH,IAAI,CAAb,EAAgBA,IAAIF,UAAUG,MAA9B,EAAsCD,GAAtC,EAA2C;AACzC,YAAMD,YAAYD,UAAUE,CAAV,EAAaE,QAAb,CAAsBL,OAAtB,CAAlB;;AAEA,YAAIE,SAAJ,EAAe;AACbI,qBAAWC,IAAX,CAAgBL,SAAhB;AACD;AACF;;AAED,UAAI,CAACI,WAAWF,MAAhB,EAAwB;AACtB;AACD;;AAED,aAAOE,UAAP;AACD;;;mCAEcP,I,EAAMS,Q,EAAUH,Q,EAAU;AACvC,UAAIX,WAAWc,QAAX,CAAJ,EAA0B;AACxBH,mBAAWG,QAAX;AACAA,mBAAWZ,gBAAX;AACD;;AAED,UAAI,CAACD,SAASa,QAAT,CAAL,EAAyB;AACvB,cAAM,IAAIC,KAAJ,CAAU,2BAAV,CAAN;AACD;;AAED,UAAMR,YAAY,KAAKS,aAAL,CAAmBX,IAAnB,CAAlB;;AAEA,UAAIY,yBAAJ;AAAA,UACIC,YADJ;;AAGA,UAAMC,cAAc,EAAEL,kBAAF,EAAYH,kBAAZ,EAApB;;AAEA,WAAKO,MAAM,CAAX,EAAeD,mBAAmBV,UAAUW,GAAV,CAAlC,EAAmDA,KAAnD,EAA0D;AACxD,YAAID,iBAAiBH,QAAjB,GAA4BA,QAAhC,EAA0C;;AAExC;AACAP,oBAAUa,MAAV,CAAiBF,GAAjB,EAAsB,CAAtB,EAAyBC,WAAzB;AACA;AACD;AACF;;AAEDZ,gBAAUM,IAAV,CAAeM,WAAf;AACD;;;oCAEed,I,EAAMM,Q,EAAU;AAC9B,UAAMJ,YAAY,KAAKS,aAAL,CAAmBX,IAAnB,CAAlB;;AAEA,UAAIgB,iBAAJ;AAAA,UACIC,yBADJ;AAAA,UAEIJ,YAFJ;;AAIA,UAAIP,QAAJ,EAAc;;AAEZ;AACA;AACA,aAAKO,MAAMX,UAAUG,MAAV,GAAmB,CAA9B,EAAkCW,WAAWd,UAAUW,GAAV,CAA7C,EAA8DA,KAA9D,EAAqE;AACnEI,6BAAmBD,SAASV,QAA5B;;AAEA,cAAIW,qBAAqBX,QAAzB,EAAmC;AACjCJ,sBAAUa,MAAV,CAAiBF,GAAjB,EAAsB,CAAtB;AACD;AACF;AACF,OAXD,MAWO;AACL;AACAX,kBAAUG,MAAV,GAAmB,CAAnB;AACD;AACF;;;kCAEaL,I,EAAM;AAClB,UAAIE,YAAY,KAAKH,UAAL,CAAgBC,IAAhB,CAAhB;;AAEA,UAAI,CAACE,SAAL,EAAgB;AACd,aAAKH,UAAL,CAAgBC,IAAhB,IAAwBE,YAAY,EAApC;AACD;;AAED,aAAOA,SAAP;AACD;;;;;;eA/GkBJ,U","file":"Components.js","sourcesContent":["import {\r\n  isFunction,\r\n  isNumber\r\n} from 'min-dash';\r\n\r\nconst DEFAULT_PRIORITY = 1000;\r\n\r\n\r\nexport default class Components {\r\n\r\n  constructor() {\r\n    this._listeners = {};\r\n  }\r\n\r\n  getComponent(type, context) {\r\n    const listeners = this._listeners[type];\r\n\r\n    if (!listeners) {\r\n      return;\r\n    }\r\n\r\n    let component;\r\n\r\n    for (let i = 0; i < listeners.length; i++) {\r\n      component = listeners[i].callback(context);\r\n\r\n      if (component) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return component;\r\n  }\r\n\r\n  getComponents(type, context) {\r\n    const listeners = this._listeners[type];\r\n\r\n    if (!listeners) {\r\n      return;\r\n    }\r\n\r\n    const components = [];\r\n\r\n    for (let i = 0; i < listeners.length; i++) {\r\n      const component = listeners[i].callback(context);\r\n\r\n      if (component) {\r\n        components.push(component);\r\n      }\r\n    }\r\n\r\n    if (!components.length) {\r\n      return;\r\n    }\r\n\r\n    return components;\r\n  }\r\n\r\n  onGetComponent(type, priority, callback) {\r\n    if (isFunction(priority)) {\r\n      callback = priority;\r\n      priority = DEFAULT_PRIORITY;\r\n    }\r\n\r\n    if (!isNumber(priority)) {\r\n      throw new Error('priority must be a number');\r\n    }\r\n\r\n    const listeners = this._getListeners(type);\r\n\r\n    let existingListener,\r\n        idx;\r\n\r\n    const newListener = { priority, callback };\r\n\r\n    for (idx = 0; (existingListener = listeners[idx]); idx++) {\r\n      if (existingListener.priority < priority) {\r\n\r\n        // prepend newListener at before existingListener\r\n        listeners.splice(idx, 0, newListener);\r\n        return;\r\n      }\r\n    }\r\n\r\n    listeners.push(newListener);\r\n  }\r\n\r\n  offGetComponent(type, callback) {\r\n    const listeners = this._getListeners(type);\r\n\r\n    let listener,\r\n        listenerCallback,\r\n        idx;\r\n\r\n    if (callback) {\r\n\r\n      // move through listeners from back to front\r\n      // and remove matching listeners\r\n      for (idx = listeners.length - 1; (listener = listeners[idx]); idx--) {\r\n        listenerCallback = listener.callback;\r\n\r\n        if (listenerCallback === callback) {\r\n          listeners.splice(idx, 1);\r\n        }\r\n      }\r\n    } else {\r\n      // clear listeners\r\n      listeners.length = 0;\r\n    }\r\n  }\r\n\r\n  _getListeners(type) {\r\n    let listeners = this._listeners[type];\r\n\r\n    if (!listeners) {\r\n      this._listeners[type] = listeners = [];\r\n    }\r\n\r\n    return listeners;\r\n  }\r\n}"]}